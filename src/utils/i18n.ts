export type Language = "en" | "zh" | "ko";

function detectLanguage(): Language {
  const raw = (
    process.env.APP_LANG ||
    process.env.LANGUAGE ||
    process.env.LANG ||
    ""
  )
    .toLowerCase()
    .trim();

  if (raw.startsWith("ko")) return "ko";
  if (raw.startsWith("zh") || raw.includes("cn")) return "zh";
  if (raw.startsWith("en")) return "en";
  // Default to Korean per request
  return "ko";
}

let currentLanguage: Language = detectLanguage();

export function getLanguage(): Language {
  return currentLanguage;
}

export function setLanguage(next: Language): void {
  currentLanguage = next;
}

const koMap: Record<string, string> = {
  // App menu
  "趋势跟随策略 (SMA30)": "추세 추종 전략 (SMA30)",
  "监控均线信号，自动进出场并维护止损/止盈":
    "이동평균 신호를 감시하여 자동 진입/청산 및 손절/익절 관리",
  "做市刷单策略": "메이커 전략",
  "双边挂单提供流动性，自动追价与风控止损": "양방향 호가로 유동성 제공, 자동 추격 및 리스크 관리",
  "基础网格策略": "기본 그리드 전략",
  "在上下边界之间布设等比网格，自动加仓与减仓":
    "상하한 사이 등비 그리드를 배치하여 자동 증감포지션",
  "偏移做市策略": "오프셋 메이커 전략",
  "根据盘口深度自动偏移挂单并在极端不平衡时撤退":
    "호가 깊이에 따라 주문을 자동 오프셋, 극단적 불균형 시 철수",
  "期现套利策略": "기초-선물 차익거래 전략",
  "监控期货与现货盘口差价，辅助发现套利机会": "선물-현물 스프레드를 감시하여 차익 기회를 탐색",
  "请选择要运行的策略": "실행할 전략을 선택하세요",
  "使用 ↑/↓ 选择，回车开始，Ctrl+C 退出。": "↑/↓로 이동, Enter 시작, Ctrl+C 종료.",
  "警告: 版权校验失败，当前版本可能被篡改。":
    "경고: 저작권 무결성 검증 실패. 현재 버전이 변조되었을 수 있습니다.",

  // Common labels
  "交易所:": "거래소:",
  "期货合约:": "선물 심볼:",
  "现货交易对:": "현물 심볼:",
  "交易对:": "거래쌍:",
  "账户": "계정",
  "订单": "주문",
  "深度": "심도",
  "行情": "시세",
  "状态:": "상태:",
  "运行中": "실행 중",
  "暂停": "일시중지",
  "方向:": "방향:",
  "最近更新时间:": "최근 업데이트:",
  "买一:": "매수1:",
  "卖一:": "매도1:",
  "更新时间:": "업데이트 시간:",
  "买一价:": "매수1가:",
  "卖一价:": "매도1가:",
  "点差:": "스프레드:",
  "按 Esc 返回菜单。": "Esc를 눌러 메뉴로 돌아가기.",
  "按 Esc 返回策略选择": "Esc를 눌러 전략 선택으로 돌아가기",
  "数据状态:": "데이터 상태:",
  "暂停原因:": "일시중지 사유:",
  "启用": "사용",
  "关闭": "끄기",
  "多": "롱",
  "空": "숏",
  "当前无持仓": "현재 포지션 없음",
  "无": "없음",
  "是": "예",
  "否": "아니오",
  yes: "예",
  no: "아니오",
  BUY: "매수",
  SELL: "매도",

  // Sections
  "资金费率": "펀딩비",
  "当前资金费率:": "현재 펀딩비:",
  "资金费率更新时间:": "펀딩비 업데이트:",
  "下次结算时间:": "다음 정산 시간:",
  "单次资金费率收益(估):": "1회 펀딩 수익(추정):",
  "日收益(估):": "일수익(추정):",
  "双边吃单手续费(估):": "왕복 테이커 수수료(추정):",
  "回本所需资金费率次数:": "손익분기까지 필요한 펀딩 횟수:",
  "现货账户余额（非0）": "현물 계정 잔고(0 제외)",
  "合约账户余额（非0）": "선물 계정 잔고(0 제외)",
  "可用": "사용 가능",
  "冻结": "동결",
  "钱包": "지갑",
  "套利差价（卖期货 / 买现货）": "차익 스프레드(선물 매도 / 현물 매수)",
  "毛价差:": "총 스프레드:",
  "扣除 taker 手续费": "테이커 수수료 차감",
  "双边": "왕복",
  "最近事件": "최근 이벤트",
  "暂无日志": "로그 없음",

  // Orderbooks
  "期货盘口": "선물 호가",
  "现货盘口": "현물 호가",

  // Grid sections
  "Grid Strategy Dashboard": "그리드 전략 대시보드",
  "网格配置": "그리드 설정",
  "单笔数量:": "주문 수량:",
  "最大仓位:": "최대 포지션:",
  "止损阈值:": "손절 임계값:",
  "重启阈值:": "재시작 임계값:",
  "自动重启:": "자동 재시작:",
  "刷新间隔:": "새로고침 간격:",
  "持仓": "포지션",
  "当前持仓:": "현재 포지션:",
  "数量:": "수량:",
  "均价:": "평단가:",
  "未实现盈亏:": "미실현 손익:",
  "标记价:": "마크 가격:",
  "网格线": "그리드 라인",
  "暂无网格线": "그리드 라인 없음",
  "目标挂单": "목표 주문",
  "暂无目标挂单": "목표 주문 없음",
  "当前挂单": "현재 주문",
  "暂无挂单": "주문 없음",

  // Maker sections
  "Maker Strategy Dashboard": "메이커 전략 대시보드",
  "实时运行": "실시간 실행",
  "等待市场数据": "시세 대기",
  "累计成交量:": "누적 체결량:",
  "开仓价:": "진입가:",
  "浮动盈亏:": "변동 손익:",
  "账户未实现盈亏:": "계정 미실현 손익:",

  // Offset maker
  "Offset Maker Strategy Dashboard": "오프셋 메이커 전략 대시보드",
  "买10档累计:": "매수 10호가 합계:",
  "卖10档累计:": "매도 10호가 합계:",
  "均衡": "균형",
  "买盘占优": "매수 우세",
  "卖盘占优": "매도 우세",
  "当前挂单策略:": "현재 주문 전략:",

  // Basis
  "Basis Arbitrage Dashboard": "기초-선물 차익거래 대시보드",
  "按 Esc 返回策略选择 ｜ 数据状态:": "Esc를 눌러 전략 선택으로 돌아가기 ｜ 데이터 상태:",
  "期货": "선물",
  "现货": "현물",

  // Trend
  "Trend Strategy Dashboard": "추세 전략 대시보드",
  "最近价格:": "최근 가격:",
  SMA30: "SMA30",
  "趋势:": "추세:",
  "正在等待交易所推送数据…": "거래소 데이터 수신 대기 중…",
  "绩效": "성과",
  "累计交易次数:": "누적 거래 수:",
  "累计收益:": "누적 수익:",
  "最近开仓信号:": "최근 진입 시그널:",
  "最近交易与事件": "최근 거래 및 이벤트",

  // Tables
  Price: "가격",
  Side: "사이드",
  Active: "활성",
  Order: "주문",
  Qty: "수량",
  Filled: "체결",
  Status: "상태",
  Type: "유형",
  ID: "ID",
  RO: "RO",
  Ticker: "티커",

  // Errors & misc
  "启动失败:": "시작 실패:",
  "请检查环境变量和网络连通性。": "환경 변수와 네트워크 연결을 확인하세요.",
  "无法启动期现套利策略:": "기초-선물 차익거래 전략 시작 실패:",
  "期现套利策略目前仅支持 Aster 交易所。请设置 EXCHANGE=aster 后重试。":
    "기초-선물 차익거래는 현재 Aster 거래소만 지원합니다. EXCHANGE=aster로 설정 후 다시 시도하세요.",
  "正在初始化期现套利监控…": "기초-선물 스프레드 모니터 초기화 중…",
  "正在初始化网格策略…": "그리드 전략 초기화 중…",
  "正在初始化做市策略…": "메이커 전략 초기화 중…",
  "正在初始化偏移做市策略…": "오프셋 메이커 전략 초기화 중…",
  "正在初始化趋势策略…": "추세 전략 초기화 중…",

  // Additional UI tokens
  "实时价格:": "실시간 가격:",
  "下界:": "하한:",
  "上界:": "상한:",
  "网格数量:": "그리드 수:",
};

export function t(input: string): string {
  if (currentLanguage !== "ko") return input;
  return koMap[input] ?? input;
}
